<template name="myIndexTpl">
	<view class="main {{skin.IS_SUB?'sub-margin-bottom':''}}">

		<!--top area begin-->
		<view class="upside upside-shadow">
			<image wx:if="{{upImg}}" mode="aspectFill" lazy-load class="upImg loading" src="{{upImg}}" />
			<view class="user-bar">
				<view class="avatar" bindtap="url" data-url="../edit/my_edit">
					<image mode="aspectFill" src="{{user.USER_AVATAR || '../../skin/images/tabbar/my_cur.png'}}" />
				</view>
				<view class="detail" bindtap="url" data-url="../points/my_points">
					<view class="name text-cut">{{user?user.USER_NAME:'欢迎回来~~~'}}</view>
					<!-- 积分信息集成到用户详情区域 -->
					<view class="points-inline">
						<view class="points-level-badge">{{pointsInfo.currentLevel.name || '新手会员'}}</view>
						<view class="points-amount">{{pointsInfo.totalPoints || 0}}积分</view>
					</view>
					<view class="progress-inline">
						<view class="progress-bar-inline">
							<view class="progress-fill-inline" style="width: {{pointsInfo.progressPercent || 0}}%; background-color: {{pointsInfo.currentLevel.color || '#95a5a6'}}"></view>
						</view>
						<view class="progress-text-inline">{{pointsInfo.nextLevel ? '距离' + pointsInfo.nextLevel.name + '还需' + pointsInfo.needPoints + '积分' : '已达最高等级'}}</view>
					</view>
				</view> 
			</view>
		</view>
		<!--top area end-->

		<!--down area begin-->
		<view class="down padding-project">
			<view class="comm-list menu today-card card-project shadow-project">
				<view class="today">
					<view class="title">我的{{skin.MEET_NAME || '预约'}}状态</view>
					<view class="list">
						<view class="item" wx:if="{{joinDisplayInfo===null || joinDisplayInfo===undefined}}">
							<view class="load loading text-s text-project" style="line-height:1!important"></view>
						</view>
						<view wx:else class="item">
							<view class="appointment-status">
								<text class="{{joinDisplayInfo === '暂无预约' ? 'text-grey' : 'text-project'}}">{{joinDisplayInfo}}</text>
							</view>
						</view>
						<!-- 保留今日预约的详细显示 -->
						<view class="item" bindtap="url" data-url="../join_detail/my_join_detail?id={{item._id}}" wx:for="{{myTodayList}}" wx:key="key" wx:if="{{myTodayList && myTodayList.length > 0}}">
							<view class="time">
								<text>{{item.JOIN_MEET_TIME_START}}~{{item.JOIN_MEET_TIME_END}}</text>

								<text wx:if="{{item.JOIN_STATUS==1}}" class="text-green status">预约成功{{item.JOIN_IS_CHECKIN==1?'，已签到':''}}</text>

								<text wx:elif="{{item.JOIN_STATUS==10}}" class="text-grey status">已取消</text>

								<text wx:elif="{{item.JOIN_STATUS==99}}" class="text-orange status">系统取消</text>

							</view>
							<view class="project text-cut">{{item.JOIN_MEET_TITLE}}</view>
						</view>
					</view>
				</view>

			</view>

			<!--base begin -->
			<view class="comm-list menu card-project shadow-project">
				<view class="item arrow" bindtap="url" data-url="../join/my_join">
					<view class="content">
						<text class="icon-activityfill my-icon-project text-project"></text>
						<text class="text-black">我的所有{{skin.MEET_NAME || '预约'}}</text>
					</view>
				</view>
				
				<!-- 新增：积分系统 -->
				<view class="item arrow" bindtap="url" data-url="../points/my_points">
					<view class="content">
						<text class="icon-coin my-icon-project text-orange"></text>
						<text class="text-black">我的积分</text>
					</view>
					<view class="extra">
						<text class="text-grey">{{pointsInfo.totalPoints || 0}}分</text>
					</view>
				</view>

				<!-- 新增：卡项系统 -->
				<view class="item arrow" bindtap="url" data-url="../../card/my_cards/my_cards">
					<view class="content">
						<text class="icon-favorfill my-icon-project text-purple"></text>
						<text class="text-black">我的卡项</text>
					</view>
				</view>

				<view class="item arrow" bindtap="url" data-url="../edit/my_edit">
					<view class="content">
						<text class="icon-edit my-icon-project text-green"></text>
						<text class="text-black">修改我的个人资料</text>
					</view>
				</view>
			</view>
			<!--base end -->

			<!--sys begin -->
			<view class="comm-list menu card-project shadow-project">

				<!-- 临时测试按钮 -->
				<!-- <view class="item arrow" bindtap="testPointsAPI">
					<view class="content">
						<text class="icon-settings my-icon-project text-orange"></text>
						<text class="text-black">初始化积分系统</text>
					</view>
				</view> -->

				<view class="item arrow" bindtap="bindSetTap">
					<view class="content">
						<text class="icon-settings my-icon-project text-grey"></text>
						<text wx:if="{{skin.IS_SUB}}" class="text-red text-bold ">系统后台管理<text class="text-grey text-normal">（可试用）</text></text>
						<text wx:else class="text-black">设置</text>
					</view>
				</view>

			</view>
			<!--sys end -->

		</view>
		<!--down area end-->

	</view> 


</template>
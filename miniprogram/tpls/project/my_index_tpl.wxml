<template name="myIndexTpl">
	<view class="main {{skin.IS_SUB?'sub-margin-bottom':''}}">

		<!--top area begin-->
		<view class="upside upside-shadow">
			<image wx:if="{{upImg}}" mode="aspectFill" lazy-load class="upImg loading" src="{{upImg}}" />
			<view class="user-bar">
				<view class="avatar" bindtap="url" data-url="../edit/my_edit">
					<image mode="aspectFill" src="{{user.USER_AVATAR || '../../skin/images/tabbar/my_cur.png'}}" />
				</view>
				<view class="detail" bindtap="url" data-url="../points/my_points">
					<view class="name text-cut">{{user?user.USER_NAME:'欢迎回来~~~'}}</view>
					<!-- 积分信息集成到用户详情区域 -->
					<view class="points-inline">
						<view class="points-level-badge">{{pointsInfo.currentLevel.name || '新手会员'}}</view>
						<view class="points-amount">{{pointsInfo.totalPoints || 0}}积分</view>
					</view>
					<view class="progress-inline">
						<view class="progress-bar-inline">
							<view class="progress-fill-inline" style="width: {{pointsInfo.progressPercent || 0}}%; background-color: {{pointsInfo.currentLevel.color || '#95a5a6'}}"></view>
						</view>
						<view class="progress-text-inline">{{pointsInfo.nextLevel ? '距离' + pointsInfo.nextLevel.name + '还需' + pointsInfo.needPoints + '积分' : '已达最高等级'}}</view>
					</view>
				</view> 
			</view>
		</view>
		<!--top area end-->

		<!--down area begin-->
		<view class="down padding-project">

			<!-- 统计数据区域 -->
			<view class="stats-section card-project shadow-project">
				<view class="stat-item" bindtap="url" data-url="../../card/my_cards/my_cards">
					<view class="stat-number">{{myStats.cardCount || 0}}</view>
					<view class="stat-label">卡包</view>
				</view>
				<view class="stat-item">
					<view class="stat-number">{{myStats.courseCount || 0}}</view>
					<view class="stat-label">课程</view>
				</view>
				<view class="stat-item" bindtap="url" data-url="../join/my_join">
					<view class="stat-number">{{myStats.appointmentCount || 0}}</view>
					<view class="stat-label">已约</view>
				</view>
			</view>

			<!-- 我的服务菜单 -->
			<view class="service-section">
				<view class="section-title">我的服务</view>
				<view class="service-grid card-project shadow-project">
					<view class="service-item" bindtap="url" data-url="../join/my_join">
						<text class="icon-activityfill service-icon text-project"></text>
						<view class="service-label">已约</view>
					</view>
					<view class="service-item" bindtap="url" data-url="../../card/my_cards/my_cards">
						<text class="icon-favorfill service-icon text-purple"></text>
						<view class="service-label">卡包</view>
					</view>
					<view class="service-item" bindtap="url" data-url="../points/my_points">
						<text class="icon-coin service-icon text-orange"></text>
						<view class="service-label">积分</view>
					</view>
					<view class="service-item" bindtap="bindSetTap">
						<text class="icon-settings service-icon text-grey"></text>
						<view class="service-label">设置</view>
					</view>
				</view>
			</view>

			<!--sys begin (hidden, integrated into service menu above) -->
			<view class="comm-list menu card-project shadow-project" style="display: none;">

				<!-- 临时测试按钮 -->
				<!-- <view class="item arrow" bindtap="testPointsAPI">
					<view class="content">
						<text class="icon-settings my-icon-project text-orange"></text>
						<text class="text-black">初始化积分系统</text>
					</view>
				</view> -->

				<view class="item arrow" bindtap="bindSetTap">
					<view class="content">
						<text class="icon-settings my-icon-project text-grey"></text>
						<text wx:if="{{skin.IS_SUB}}" class="text-red text-bold ">系统后台管理<text class="text-grey text-normal">（可试用）</text></text>
						<text wx:else class="text-black">设置</text>
					</view>
				</view>

			</view>
			<!--sys end -->

		</view>
		<!--down area end-->

	</view> 


</template>
<wxs module="dateHelper">
	// 检查选中的日期是否在卡片的日期数据范围内
	var isDateInRange = function(selectedStart, selectedEnd, daysWithData) {
		if (!daysWithData || !daysWithData.length) return false;
		if (!selectedStart || !selectedEnd) return false;

		// 检查 daysWithData 中是否有任何日期在选中的范围内
		for (var i = 0; i < daysWithData.length; i++) {
			var day = daysWithData[i];
			if (day >= selectedStart && day <= selectedEnd) {
				return true;
			}
		}
		return false;
	};

	module.exports = {
		isDateInRange: isDateInRange
	};
</wxs>

<template name="calendarIndexTpl">
	<view wx:if="{{isLoad===null}}" class="margin-top load notexist text-l load-project"></view>
	<view wx:if="{{isLoad===false}}" class="margin-top load loading text-l load-project"></view>

	<view class="main {{skin && skin.IS_SUB?'sub-margin-bottom':''}}" wx:if="{{isLoad}}">
		<view class="plan-date">
			<!-- 横向滚动日历（未来4个月） - 改为按周显示 -->
			<cmpt-calendar-scroll hasDays="{{hasDays}}" bind:click="bindClickCmpt" mode="week" />

			<!-- 其他备选方案 -->
			<!-- <cmpt-calendar-week hasDays="{{hasDays}}" bind:click="bindClickCmpt" /> -->
			<!-- <cmpt-calendar mode="one" hasDays="{{hasDays}}" bind:click="bindClickCmpt" bind:monthChange="bindMonthChangeCmpt" /> -->
		</view>

		<view class="list padding-project">
			<view wx:if="{{list===null}}" class="load loading text-l text-grey"></view>
			<text wx:elif="{{list.length==0}}" class="no-project icon-emoji text-l text-grey"> 本日没有可预约的项目哦~</text>

			<!-- 新的卡片样式 - 左中右三个区域 -->
			<view class="meet-card-horizontal" wx:for="{{list}}" wx:key="_id" bindtap="url" data-url="../../meet/detail/meet_detail?id={{item.meetId}}&day={{item.day}}&timeStart={{item.timeStart}}&timeEnd={{item.timeEnd}}">

				<!-- 左侧区域：日期 + 头像 -->
				<view class="card-left-section">
					<view class="date-info">
						<text class="date-text">{{item.dayText}}</text>
						<text class="weekday-text">{{item.weekDay}}</text>
					</view>
					<view class="avatar-wrapper">
						<image class="instructor-avatar"
							   src="{{item.instructorAvatar || item.pic}}"
							   mode="aspectFill"
							   lazy-load="{{true}}" />
					</view>
				</view>

				<!-- 中间区域：标签 + 时长 + 导师 + 人数 + 开课提示 -->
				<view class="card-middle-section">
					<!-- 分类标签 -->
					<view class="category-tag category-tag-{{item.typeId}}" wx:if="{{item.typeName}}">
						{{item.typeName}}
					</view>

					<!-- 时间段 + 时长 -->
					<view class="time-duration">
						<text class="time-range">{{item.timeStart}}-{{item.timeEnd}}</text>
						<text class="duration">{{item.duration}}</text>
					</view>

					<!-- 导师名字 -->
					<view class="instructor-info">
						<text class="instructor-label">导师：</text>
						<text class="instructor-name">{{item.instructorName}}</text>
					</view>

					<!-- 预约人数 -->
					<view class="booking-info">
						<text class="booking-count">已约{{item.bookedCount}}/{{item.maxCount}}人</text>
					</view>

					<!-- 开课提示 -->
					<view class="class-notice">
						<text class="notice-text">满 2 人开课</text>
					</view>
				</view>

				<!-- 右侧区域：预约按钮 -->
				<view class="card-right-section">
					<button class="book-button">预约</button>
				</view>
			</view>

		</view>
	</view>

</template>
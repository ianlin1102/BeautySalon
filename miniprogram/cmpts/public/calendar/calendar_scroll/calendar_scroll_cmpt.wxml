<wxs src="../../../../tpls/wxs/tools.wxs" module="tools" />
<view class="scroll-calendar-wrapper">
	<!-- 头部操作栏 -->
	<view class="scroll-header">
		<view class="scroll-title">{{mode === 'week' ? '选择预约周期' : '选择预约日期'}}</view>
		<view class="scroll-actions">
			<view class="scroll-btn" bindtap="bindTodayTap">
				<text class="icon-homefill"></text>
				<text class="btn-text">{{mode === 'week' ? '本周' : '今天'}}</text>
			</view>
			<view class="scroll-btn" bindtap="bindToggleCalendar">
				<text class="icon-calendar"></text>
				<text class="btn-text">日历</text>
			</view>
		</view>
	</view>

	<!-- 横向滚动周范围条 (按周模式) -->
	<scroll-view wx:if="{{mode === 'week'}}" class="scroll-container"
				 scroll-x="{{true}}"
				 scroll-into-view="{{scrollIntoView}}"
				 show-scrollbar="{{false}}">
		<view class="scroll-weeks">
			<view class="week-item {{item.startDate === selectedDayData ? 'selected' : ''}} {{item.isCurrentWeek ? 'is-current-week' : ''}}"
				  wx:for="{{scrollWeeks}}"
				  wx:key="range"
				  id="week-{{index}}"
				  data-item="{{item}}"
				  bindtap="bindWeekTap">

				<!-- 月份分隔标识 -->
				<view class="month-divider" wx:if="{{index === 0 || item.startMonth !== scrollWeeks[index-1].startMonth}}">
					{{item.startMonth}}月
				</view>

				<!-- 周范围主体 -->
				<view class="week-content">
					<!-- 日期范围 -->
					<view class="week-range">{{item.displayText}}</view>
					<!-- 星期范围 -->
					<view class="week-label">周一-周日</view>
					<!-- 数据点 -->
					<view class="has-dot" wx:if="{{item.hasData}}"></view>
				</view>
			</view>
		</view>
	</scroll-view>

	<!-- 横向滚动日期条 (按天模式) -->
	<scroll-view wx:else class="scroll-container"
				 scroll-x="{{true}}"
				 scroll-into-view="{{scrollIntoView}}"
				 show-scrollbar="{{false}}">
		<view class="scroll-days">
			<view class="day-item {{item.full === selectedDayData ? 'selected' : ''}} {{item.isToday ? 'is-today' : ''}}"
				  wx:for="{{scrollDays}}"
				  wx:key="full"
				  id="day-{{index}}"
				  data-day="{{item.full}}"
				  data-item="{{item}}"
				  bindtap="bindDayTap">

				<!-- 月份分隔标识 -->
				<view class="month-divider" wx:if="{{item.day === 1}}">
					{{item.month}}月
				</view>

				<!-- 日期主体 -->
				<view class="day-content">
					<!-- 两周内显示星期，两周后显示月份 -->
					<view class="day-week" wx:if="{{!item.showMonth}}">周{{item.weekDay}}</view>
					<view class="day-month" wx:else>{{item.month}}月</view>
					<view class="day-num">{{item.day}}</view>
					<!-- 数据点 -->
					<view class="has-dot" wx:if="{{tools.includes(hasDays, item.full)}}"></view>
				</view>
			</view>
		</view>
	</scroll-view>

	<!-- 完整日历弹窗 -->
	<view class="calendar-popup" wx:if="{{showCalendar}}" bindtap="bindToggleCalendar">
		<view class="popup-content" catchtap="stopPropagation">
			<view class="popup-header">
				<text class="popup-title">选择日期</text>
				<view class="popup-close" bindtap="bindToggleCalendar">
					<text class="icon-close"></text>
				</view>
			</view>
			<cmpt-calendar mode="one"
						   year="{{calendarYear}}"
						   month="{{calendarMonth}}"
						   hasDays="{{hasDays}}"
						   oneDoDay="{{selectedDayData}}"
						   bind:click="bindFullCalendarClick" />
		</view>
	</view>
</view>

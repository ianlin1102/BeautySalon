<view wx:if="{{id&&isLoad===null}}" class="margin-top load notexist text-l text-grey"></view>
<view wx:if="{{id&&isLoad===false}}" class="margin-top load loading text-l text-grey"></view>
<block wx:if="{{isAdmin&& (id&&isLoad || !id)}}">
	<view class="main-admin">

		<view class="form-box shadow">
			<view class="form-group">
				<view class="title must">标题</view>
				<input placeholder="简短的标题" placeholder-class="phc" model:value="{{formTitle}}" focus="{{formTitleFocus}}" maxlength="50"></input>
			</view>
			<view wx:if="{{formTitleFocus}}" class="hint-desc error">{{formTitleFocus}}</view>

			<view class="form-group arrow">
				<view class="title must">分类</view>
				<cmpt-picker id="cate-picker" sourceData="{{typeIdOptions}}" bind:select="url" data-type="picker" data-item="formTypeId" item="{{formTypeId}}"> </cmpt-picker>
			</view>
			<view wx:if="{{formTypeIdFocus}}" class="hint-desc error">{{formTypeIdFocus}}</view>

			<view id="formStyleSet" class="form-group arrow" bindtap="url" data-url="../cover/admin_meet_cover">
				<view class="title must">封面设置<text class="text-grey text-normal margin-left-xs">(必填)</text></view>
				<view wx:if="{{formStyleSet.pic}}" class="form-text"></view>
				<view wx:else class="form-text text-orange">封面图片未设置</view>
			</view>
			<view wx:if="{{formStyleSetFocus}}" class="hint-desc error">{{formStyleSetFocus}}</view>

			<view class="form-group arrow" bindtap="url" data-url="../content/admin_meet_content">
				<view class="title must">详细介绍<text class="text-grey text-normal margin-left-xs">(必填)</text></view>
				<view wx:if="{{contentDesc==='未填写'}}" class="form-text text-orange">详细介绍未填写</view>
				<view wx:else class="form-text">{{contentDesc}}</view>
			</view>
			<view wx:if="{{formContentFocus}}" class="hint-desc error">{{formContentFocus}}</view>

			<view class="form-group">
				<view class="title must" bindtap="url" data-type="hint" data-url="用户看到的预约列表排序，小的先显示">排序号<text class="icon-question margin-left-xxs text-normal"></text></view>
				<input placeholder="排序号，小的先显示" type="digit" placeholder-class="phc" model:value="{{formOrder}}" focus="{{formOrderFocus}}" maxlength="4"></input>
			</view>
			<view wx:if="{{formOrderFocus}}" class="hint-desc error">{{formOrderFocus}}</view>

		</view>

		<view id="formDaysSet" class="form-box shadow">
			<view bindtap="url" data-url="../time/admin_meet_time" class="form-group arrow">
				<view class="title must">预约时间设置</view>
				<view wx:if="{{formDaysSet.length}}" class="form-text text-admin">{{formDaysSet.length}}天可约</view>
				<view wx:else class="form-text text-orange">请配置可预约时段</view>
			</view>
			<view wx:if="{{formDaysSetFocus}}" class="hint-desc error">{{formDaysSetFocus}}</view>


			<view class="form-group">
				<view class="title must">是否显示可预约人数</view>
				<cmpt-picker mark="isShowLimit" style="flex:1" model:item="{{formIsShowLimit}}" sourceDataStr="0=不显示给用户,1=显示给用户" />
			</view>
			<view wx:if="{{formIsShowLimitFocus}}" class="hint-desc error">{{formIsShowLimitFocus}}</view>

			<!-- 消费设置 -->
			<view class="form-group">
				<view class="title">需要卡项消费</view>
				<switch bindchange="bindCostEnabledChange" checked="{{formCostSet.isEnabled}}" color="#667eea"/>
			</view>

			<view wx:if="{{formCostSet.isEnabled}}">
				<view class="form-group">
					<view class="title must">消费类型</view>
					<picker bindchange="bindCostTypeChange" value="{{formCostTypeIndex}}" range="{{costTypeOptions}}" range-key="label">
						<view class="form-text text-admin">
							<text wx:if="{{formCostSet.costType === 'times'}}">仅次数卡</text>
							<text wx:elif="{{formCostSet.costType === 'balance'}}">仅储值卡</text>
							<text wx:elif="{{formCostSet.costType === 'both'}}">次数卡或储值卡</text>
							<text wx:else>请选择</text>
						</view>
					</picker>
				</view>

				<view wx:if="{{formCostSet.costType === 'times' || formCostSet.costType === 'both'}}" class="form-group">
					<view class="title must">消耗次数</view>
					<input type="digit" bindinput="bindTimesInput" value="{{formCostSet.timesCost}}" placeholder="请输入消耗次数" class="input-admin" />
				</view>

				<view wx:if="{{formCostSet.costType === 'balance' || formCostSet.costType === 'both'}}" class="form-group">
					<view class="title must">消耗金额(元)</view>
					<input type="digit" bindinput="bindBalanceInput" value="{{formCostSet.balanceCost}}" placeholder="请输入消耗金额" class="input-admin" />
				</view>

				<view wx:if="{{formCostSet.costType === 'both'}}" class="form-group">
					<view class="title">允许系统自动选卡</view>
					<switch bindchange="bindAutoSelectChange" checked="{{formCostSet.allowAutoSelect}}" color="#667eea"/>
				</view>

				<view class="form-group">
					<view class="form-text text-grey text-s">当前设置：{{costSetDisplay}}</view>
				</view>
			</view>

			<!-- 取消限制设置 -->
			<view class="form-group margin-top">
				<view class="title">取消时间限制<text class="text-grey text-normal margin-left-xs">(用户)</text></view>
				<switch bindchange="bindCancelLimitChange" checked="{{formCancelSet.isLimit}}" color="#667eea"/>
			</view>

			<view wx:if="{{formCancelSet.isLimit}}" class="form-group" bindtap="bindShowCancelPicker">
				<view class="title must">限制取消时间</view>
				<view class="form-text text-admin">{{cancelSetDisplay}}</view>
			</view>

		</view>

		<view class="form-box shadow">
			<view class="form-group">
				<view class="title must">用户填写资料设置 <text class="text-grey text-normal">(共{{formFormSet.length}}个字段)</text></view>
			</view>
			<cmpt-form-set id="form-set" bind:formset="bindFormSetCmpt" fields="{{formFormSet}}" />
		</view>

		<button wx:if="{{!id}}" bindtap="bindFormAddSubmit" class="btn-admin margin-top-l">创建</button>
		<button wx:else bindtap="bindFormEditSubmit" class="btn-admin margin-top-l">保存</button>

	</view>

	<!-- 取消时间限制选择器 -->
	<view class="cancel-picker-modal" wx:if="{{showCancelPicker}}" bindtap="bindHideCancelPicker" catchtouchmove="preventTouchMove">
		<view class="cancel-picker-container" catchtap="preventClose" catchtouchmove="preventTouchMove">
			<view class="cancel-picker-header">
				<view class="cancel-btn" bindtap="bindHideCancelPicker">取消</view>
				<view class="cancel-title">选择取消限制时间</view>
				<view class="cancel-confirm" bindtap="bindConfirmCancelPicker">确定</view>
			</view>
			<view class="cancel-picker-body">
				<picker-view indicator-style="height: 50px;" style="width: 100%; height: 300px;" value="{{cancelPickerValue}}" bindchange="bindCancelPickerChange">
					<picker-view-column>
						<view wx:for="{{cancelDayOptions}}" wx:key="value" class="picker-item">{{item.label}}</view>
					</picker-view-column>
					<picker-view-column wx:if="{{cancelPickerValue[0] !== cancelDayOptions.length - 1}}">
						<view wx:for="{{cancelHourOptions}}" wx:key="index" class="picker-item">{{item}}时</view>
					</picker-view-column>
					<picker-view-column wx:if="{{cancelPickerValue[0] !== cancelDayOptions.length - 1}}">
						<view wx:for="{{cancelMinuteOptions}}" wx:key="index" class="picker-item">{{item}}分</view>
					</picker-view-column>
				</picker-view>
			</view>
		</view>
	</view>

</block>